<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£è¡Œæ—¥å¿— - 2025äº‘ç«¯ç‰ˆ</title>
    <style>
        /* === ç•Œé¢æ ·å¼ === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            min-height: 100vh; padding: 20px; color: #333;
        }
        .container {
            max-width: 1100px; margin: 0 auto; background: white;
            border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            overflow: hidden; min-height: 80vh; display: flex; flex-direction: column;
        }
        /* å¤´éƒ¨å‡çº§ï¼šæ”¯æŒå·¦å³å¸ƒå±€ */
        .header {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            padding: 20px 25px; color: white;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header-left h1 { font-size: 1.5rem; margin-bottom: 5px; }
        .header-right { text-align: right; }
        
        /* å¯¼èˆªæ  */
        .nav-tabs { display: flex; background: #f1f5f9; padding: 0 10px; }
        .tab {
            flex: 1; padding: 15px; text-align: center; cursor: pointer;
            font-weight: 500; color: #64748b; transition: 0.3s; border-bottom: 3px solid transparent;
        }
        .tab.active { color: #2563eb; border-bottom-color: #2563eb; background: white; }
        .tab:hover:not(.active) { background: #e2e8f0; }

        /* å†…å®¹åŒº */
        .content { padding: 20px; flex: 1; overflow-y: auto; }
        .tab-content { display: none; animation: fadeIn 0.3s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* AI è¾“å…¥åŒº */
        .ai-box {
            border: 2px dashed #cbd5e1; padding: 20px; border-radius: 15px;
            background: #f8fafc; margin-bottom: 20px;
        }
        /* æ–°å¢ï¼šKey è¾“å…¥æ¡†æ ·å¼ */
        .key-input-group {
            margin-bottom: 15px; background: white; padding: 10px; 
            border-radius: 8px; border: 1px solid #e2e8f0;
            display: flex; align-items: center; gap: 10px;
        }

        textarea {
            width: 100%; height: 120px; padding: 15px; border: 1px solid #cbd5e1;
            border-radius: 10px; resize: vertical; font-family: monospace; margin-bottom: 15px;
        }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.9rem; }
        .btn-primary { background: #2563eb; color: white; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-success { background: #10b981; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-outline { background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); }
        .btn-outline:hover { background: rgba(255,255,255,0.3); }

        /* è¡¨å•ç½‘æ ¼ */
        .form-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px; background: #f1f5f9; padding: 20px; border-radius: 15px; margin-top: 15px;
        }
        .form-group label { display: block; font-size: 0.8rem; color: #64748b; margin-bottom: 4px; }
        .form-group input, .form-group select { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; }
        
        /* åˆ—è¡¨å¡ç‰‡ */
        .log-card {
            background: white; border: 1px solid #e2e8f0; border-radius: 10px;
            padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between;
            align-items: center; transition: 0.2s;
        }
        .log-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .tag { padding: 2px 8px; border-radius: 10px; font-size: 0.75rem; background: #e2e8f0; color: #475569; }
        .tag.å›½å†… { background: #dbeafe; color: #1e40af; }

        /* å¤æ‚æŠ¥è¡¨è¡¨æ ¼ */
        .table-container { overflow-x: auto; margin-top: 10px; }
        .excel-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; min-width: 1000px; }
        .excel-table th, .excel-table td { border: 1px solid #cbd5e1; padding: 6px; text-align: center; }
        .excel-table th { background: #f8fafc; font-weight: 600; color: #334155; }
        .excel-table tr:hover { background-color: #f1f5f9; }

        /* ç™»å½•å±‚ */
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            display: flex; justify-content: center; align-items: center; z-index: 100;
        }
        .login-box { background: white; padding: 40px; border-radius: 20px; text-align: center; width: 350px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        
        .spinner {
            width: 16px; height: 16px; border: 2px solid #ffffff;
            border-top: 2px solid transparent; border-radius: 50%;
            animation: spin 1s linear infinite; display: inline-block; margin-right: 5px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h2 style="margin-bottom: 20px; color: #1e40af;">âœˆï¸ é£è¡Œæ—¥å¿—ç™»å½•</h2>
            <button class="btn btn-primary" style="width: 100%; padding: 12px; margin-bottom: 15px; font-size: 1rem;" onclick="loginWithGoogle()">
                Google è´¦å·ç™»å½•
            </button>
            <p style="font-size: 0.8rem; color: #64748b;">ç™»å½•ååœ¨åº”ç”¨å†…å¡«å†™ API Key</p>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ -->
    <div id="app" class="container" style="display: none;">
        <div class="header">
            <div class="header-left">
                <h1>é£è¡Œå°æ—¶æ˜ç»†è¡¨</h1>
                <p id="userInfo" style="opacity: 0.9; font-size: 0.85rem;">æœªç™»å½•</p>
            </div>
            <div class="header-right">
                <!-- é€€å‡ºæŒ‰é’® -->
                <button class="btn btn-outline" onclick="doLogout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="tab active" onclick="switchTab('input')">ğŸ“ æ™ºèƒ½å½•å…¥</div>
            <div class="tab" onclick="switchTab('list')">ğŸ“‹ å†å²è®°å½•</div>
            <div class="tab" onclick="switchTab('report')">ğŸ“Š ç»Ÿè®¡æŠ¥è¡¨</div>
        </div>

        <!-- å½•å…¥é¡µ -->
        <div id="inputTab" class="tab-content active" class="content">
            <div class="ai-box">
                <h3 style="margin-bottom: 10px; color: #334155;">ğŸ¤– ä»»åŠ¡ä¹¦è¯†åˆ«</h3>
                
                <!-- æ–°å¢ï¼šè¿™é‡Œå¯ä»¥éšæ—¶æ”¹ Key -->
                <div class="key-input-group">
                    <span style="font-size: 1.2rem;">ğŸ”‘</span>
                    <input type="password" id="innerApiKey" placeholder="åœ¨æ­¤å¡«å…¥ DeepSeek Key (sk-...)" style="border: none; outline: none; width: 100%; font-size: 0.9rem;">
                </div>

                <textarea id="ocrInput" placeholder="è¯·åœ¨æ­¤å¤„ç²˜è´´ä»»åŠ¡ä¹¦æ–‡æœ¬ (æ”¯æŒä¹±ç è‡ªåŠ¨çº é”™)..."></textarea>
                <button id="aiBtn" class="btn btn-primary" onclick="processAI()">âœ¨ AI æå–æ•°æ®</button>
            </div>

            <div id="editForm" style="display: none;">
                <h3 style="color: #334155; padding-left: 5px; border-left: 4px solid #2563eb;">æ ¸å¯¹å¹¶ä¿å­˜</h3>
                <div class="form-grid">
                    <div class="form-group"><label>æ—¥æœŸ</label><input type="date" id="f_date"></div>
                    <div class="form-group"><label>èµ·é£æœºåœº</label><input type="text" id="f_dep"></div>
                    <div class="form-group"><label>è½åœ°æœºåœº</label><input type="text" id="f_arr"></div>
                    <div class="form-group"><label>åŒºåŸŸåˆ†ç±»</label>
                        <select id="f_cat">
                            <option value="å›½å†…">å›½å†…</option>
                            <option value="æ¸¯æ¾³å°">æ¸¯æ¾³å°</option>
                            <option value="äºšæ´²å›½é™…">äºšæ´²å›½é™…(éæ¸¯æ¾³å°)</option>
                            <option value="æ´²é™…">æ´²é™…(äºšæ´²å¤–)</option>
                        </select>
                    </div>
                    <div class="form-group"><label>ç©ºä¸­æ—¶é—´ (h)</label><input type="number" step="0.01" id="f_air"></div>
                    <div class="form-group"><label>æ»‘è¡Œå¤©æ•°</label><input type="number" id="f_block_days" value="1"></div>
                    
                    <div class="form-group"><label>å¤œèˆª (18:30-24)</label><input type="number" step="0.01" id="f_night1"></div>
                    <div class="form-group"><label>å¤œèˆª (0-6:30)</label><input type="number" step="0.01" id="f_night2"></div>
                    
                    <div class="form-group"><label>é©»å¤–ç±»å‹</label>
                        <select id="f_overnight">
                            <option value="å›½å†…æ— è¿‡å¤œ">å›½å†…æ— è¿‡å¤œ</option>
                            <option value="å›½å†…æœ‰è¿‡å¤œ">å›½å†…æœ‰è¿‡å¤œ</option>
                            <option value="å›½é™…æ— è¿‡å¤œ">å›½é™…æ— è¿‡å¤œ</option>
                            <option value="å›½é™…æœ‰è¿‡å¤œ">å›½é™…æœ‰è¿‡å¤œ</option>
                        </select>
                    </div>
                    <div class="form-group"><label>å›½å†…æœºç»„é¤</label><input type="number" id="f_meal_d" value="0"></div>
                    <div class="form-group"><label>å›½é™…æœºç»„é¤</label><input type="number" id="f_meal_i" value="0"></div>
                    <div class="form-group"><label>æ³•å®šèŠ‚å‡æ—¥(å¤©)</label><input type="number" id="f_holiday" value="0"></div>
                    <!-- éšè—å­—æ®µ -->
                    <input type="hidden" id="f_takeoff"><input type="hidden" id="f_landing">
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn" style="background: #cbd5e1; margin-right: 10px;" onclick="document.getElementById('editForm').style.display='none'">å–æ¶ˆ</button>
                    <button class="btn btn-success" onclick="saveRecord()">ğŸ’¾ ç¡®è®¤ä¿å­˜</button>
                </div>
            </div>
        </div>

        <!-- åˆ—è¡¨é¡µ -->
        <div id="listTab" class="tab-content" class="content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h3>æœ€è¿‘è®°å½•</h3>
                <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8rem;" onclick="deleteLastRecord()">æ’¤é”€ä¸Šä¸€æ¡</button>
            </div>
            <div id="logList"></div>
        </div>

        <!-- æŠ¥è¡¨é¡µ -->
        <div id="reportTab" class="tab-content" class="content">
            <div style="background: #f8fafc; padding: 15px; border-radius: 10px; display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                <label style="font-weight: 600;">ç»Ÿè®¡æœˆä»½ï¼š</label>
                <input type="month" id="reportMonth" onchange="renderReport()" style="padding: 5px 10px; border: 1px solid #cbd5e1; border-radius: 6px;">
            </div>
            
            <div class="table-container">
                <table class="excel-table" id="reportTable">
                    <!-- JS ç”Ÿæˆè¡¨å¤´ -->
                </table>
            </div>
            <p style="margin-top: 15px; color: #64748b; font-size: 0.85rem;">* æç¤ºï¼šæ‚¨å¯ä»¥ç›´æ¥å¤åˆ¶ä¸Šæ–¹è¡¨æ ¼å†…å®¹ç²˜è´´åˆ°å…¬å¸çš„ Excel è¡¨ä¸­ã€‚</p>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, limit, getDocs, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        // æ–°å¢äº† signOut æ¨¡å—
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // ============================================================
        // â–¼â–¼â–¼â–¼â–¼ ä½ çš„é…ç½®å·²é›†æˆ â–¼â–¼â–¼â–¼â–¼
        // ============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCFk4f7bKUHlb3d1Cg1jyS1EM-SPC4pr40",
            authDomain: "myflightlog-1f4cb.firebaseapp.com",
            projectId: "myflightlog-1f4cb",
            storageBucket: "myflightlog-1f4cb.firebasestorage.app",
            messagingSenderId: "181072044112",
            appId: "1:181072044112:web:ca312da2d4780227cef155"
        };
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let allRecords = [];

        // ç™»å½•åŠŸèƒ½
        window.loginWithGoogle = async () => {
            try { await signInWithPopup(auth, provider); } catch (e) { alert("ç™»å½•å¤±è´¥: " + e.message); }
        };

        // é€€å‡ºåŠŸèƒ½
        window.doLogout = async () => {
            try { 
                await signOut(auth);
                // é€€å‡ºåä¸éœ€è¦é‡ç½® Keyï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç™»å½•ç›´æ¥ç”¨
                // localStorage.removeItem("openai_key"); 
            } catch (e) { alert("é€€å‡ºå¤±è´¥: " + e.message); }
        };

        // æ ‡ç­¾åˆ‡æ¢
        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId + 'Tab').classList.add('active');
            if(tabId === 'report') renderReport();
        };

        // ç›‘å¬ç™»å½•çŠ¶æ€
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('userInfo').textContent = `ğŸ‘¤ ${user.email}`;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                document.getElementById('reportMonth').value = new Date().toISOString().slice(0, 7);

                // ç›‘å¬æ•°æ®åº“å˜åŒ–
                const q = query(collection(db, `users/${user.uid}/logs`), orderBy("date", "desc"));
                onSnapshot(q, (snapshot) => {
                    allRecords = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                    renderList();
                    renderReport();
                });
                
                // æ¢å¤ API Key åˆ°å†…éƒ¨è¾“å…¥æ¡†
                const savedKey = localStorage.getItem("openai_key");
                if(savedKey) document.getElementById("innerApiKey").value = savedKey;
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('app').style.display = 'none';
            }
        });

        // AI å¤„ç†é€»è¾‘
        window.processAI = async () => {
            const text = document.getElementById('ocrInput').value;
            // ä»æ–°çš„è¾“å…¥æ¡†è·å– Key
            const apiKey = document.getElementById('innerApiKey').value;
            
            if (!apiKey) return alert("è¯·å…ˆè¾“å…¥ API Key");
            localStorage.setItem("openai_key", apiKey); // è®°ä½ Key

            if (!text.trim()) return alert("è¯·å…ˆç²˜è´´ä»»åŠ¡ä¹¦");

            const btn = document.getElementById('aiBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span class="spinner"></span> åˆ†æä¸­...';
            btn.disabled = true;

            const prompt = `
            è¯·ä»ä¹±ç æ–‡æœ¬ä¸­æå–é£è¡Œæ•°æ®ï¼Œè¿”å›çº¯JSONï¼š
            æ–‡æœ¬ï¼š${text}
            å­—æ®µï¼š
            date(YYYY-MM-DD), dep(èµ·é£æœºåœº), arr(è½åœ°æœºåœº), 
            category("å›½å†…"|"æ¸¯æ¾³å°"|"äºšæ´²å›½é™…"|"æ´²é™…"),
            takeoff(HH:MM), landing(HH:MM),
            air_time(æ•°å­—å°æ—¶), block_days(æ•°å­—,é»˜è®¤1),
            night1(18:30-24:00æ—¶é•¿), night2(00:00-06:30æ—¶é•¿),
            overnight("å›½å†…æ— è¿‡å¤œ"|"å›½å†…æœ‰è¿‡å¤œ"|"å›½é™…æ— è¿‡å¤œ"|"å›½é™…æœ‰è¿‡å¤œ")
            å¦‚æœæ— æ³•åˆ¤æ–­åˆ™ç•™ç©ºæˆ–è®¾ä¸º0ã€‚
            `;

            try {
                // DeepSeek æ¥å£
                const res = await fetch("https://api.deepseek.com/chat/completions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
                    body: JSON.stringify({
                        model: "deepseek-chat", 
                        messages: [{role: "user", content: prompt}], 
                        temperature: 0.1
                    })
                });
                
                const data = await res.json();
                if(data.error) throw new Error(data.error.message);
                
                const content = data.choices[0].message.content.replace(/```json|```/g, '');
                const result = JSON.parse(content);

                // å¡«å…¥è¡¨å•
                document.getElementById('f_date').value = result.date || '';
                document.getElementById('f_dep').value = result.dep || '';
                document.getElementById('f_arr').value = result.arr || '';
                document.getElementById('f_cat').value = result.category || 'å›½å†…';
                document.getElementById('f_takeoff').value = result.takeoff || '';
                document.getElementById('f_landing').value = result.landing || '';
                document.getElementById('f_air').value = result.air_time || 0;
                document.getElementById('f_block_days').value = result.block_days || 1;
                document.getElementById('f_night1').value = result.night1 || 0;
                document.getElementById('f_night2').value = result.night2 || 0;
                document.getElementById('f_overnight').value = result.overnight || 'å›½å†…æ— è¿‡å¤œ';
                
                document.getElementById('editForm').style.display = 'block';
            } catch (e) {
                alert("AI è§£æå¤±è´¥: " + e.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        };

        // ä¿å­˜è®°å½•
        window.saveRecord = async () => {
            if (!currentUser) return;
            const record = {
                date: document.getElementById('f_date').value,
                dep: document.getElementById('f_dep').value,
                arr: document.getElementById('f_arr').value,
                category: document.getElementById('f_cat').value,
                air_time: parseFloat(document.getElementById('f_air').value) || 0,
                block_days: parseInt(document.getElementById('f_block_days').value) || 0,
                night1: parseFloat(document.getElementById('f_night1').value) || 0,
                night2: parseFloat(document.getElementById('f_night2').value) || 0,
                overnight: document.getElementById('f_overnight').value,
                meal_d: parseInt(document.getElementById('f_meal_d').value) || 0,
                meal_i: parseInt(document.getElementById('f_meal_i').value) || 0,
                holiday: parseInt(document.getElementById('f_holiday').value) || 0,
                timestamp: new Date()
            };

            try {
                await addDoc(collection(db, `users/${currentUser.uid}/logs`), record);
                document.getElementById('editForm').style.display = 'none';
                document.getElementById('ocrInput').value = '';
                alert("âœ… ä¿å­˜æˆåŠŸ");
                switchTab('list');
            } catch (e) { alert("ä¿å­˜å¤±è´¥: " + e.message); }
        };

        // åˆ é™¤æœ€åä¸€æ¡
        window.deleteLastRecord = async () => {
            if(!allRecords.length) return;
            if(confirm("ç¡®å®šåˆ é™¤æœ€è¿‘çš„ä¸€æ¡è®°å½•å—ï¼Ÿ")) {
                try {
                    await deleteDoc(doc(db, `users/${currentUser.uid}/logs`, allRecords[0].id));
                } catch(e) { alert("åˆ é™¤å¤±è´¥: " + e.message); }
            }
        };

        // æ¸²æŸ“åˆ—è¡¨
        function renderList() {
            const listDiv = document.getElementById('logList');
            listDiv.innerHTML = allRecords.map(r => `
                <div class="log-card">
                    <div>
                        <div style="font-weight: 600; color: #1e293b; margin-bottom: 4px;">
                            ${r.date} &nbsp; ${r.dep} â” ${r.arr}
                        </div>
                        <div style="font-size: 0.85rem; color: #64748b;">
                            âœˆï¸ ${r.air_time}h | ğŸŒ™ ${(r.night1+r.night2).toFixed(2)}h | ${r.overnight}
                        </div>
                    </div>
                    <span class="tag ${r.category}">${r.category}</span>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æŠ¥è¡¨
        window.renderReport = () => {
            const monthStr = document.getElementById('reportMonth').value;
            const [y, m] = monthStr.split('-');
            const data = allRecords.filter(r => r.date.startsWith(monthStr));

            // åˆå§‹åŒ–ç»Ÿè®¡
            const s = { 
                d_air:0, d_bk:0, h_air:0, h_bk:0, a_air:0, a_bk:0, i_air:0, i_bk:0,
                n1:0, n2:0, o_d0:0, o_d1:0, o_i0:0, o_i1:0, m_d:0, m_i:0, hol:0 
            };

            data.forEach(r => {
                if(r.category==='å›½å†…') { s.d_air+=r.air_time; s.d_bk+=r.block_days; }
                else if(r.category==='æ¸¯æ¾³å°') { s.h_air+=r.air_time; s.h_bk+=r.block_days; }
                else if(r.category==='äºšæ´²å›½é™…') { s.a_air+=r.air_time; s.a_bk+=r.block_days; }
                else { s.i_air+=r.air_time; s.i_bk+=r.block_days; }
                
                s.n1+=r.night1; s.n2+=r.night2;
                s.m_d+=r.meal_d; s.m_i+=r.meal_i;
                s.hol+=r.holiday;

                if(r.overnight==='å›½å†…æ— è¿‡å¤œ') s.o_d0++;
                if(r.overnight==='å›½å†…æœ‰è¿‡å¤œ') s.o_d1++;
                if(r.overnight==='å›½é™…æ— è¿‡å¤œ') s.o_i0++;
                if(r.overnight==='å›½é™…æœ‰è¿‡å¤œ') s.o_i1++;
            });

            document.getElementById('reportTable').innerHTML = `
                <thead>
                    <tr><th colspan="16" style="background:#e2e8f0; font-size:1.1rem; padding:10px;">${y}å¹´${m}æœˆé£è¡Œå°æ—¶æ˜ç»†</th></tr>
                    <tr>
                        <th rowspan="2">äººå‘˜</th>
                        <th colspan="2">å›½å†…é£è¡Œ</th><th colspan="2">æ¸¯æ¾³å°</th>
                        <th colspan="2">äºšæ´²(éæ¸¯æ¾³)</th><th colspan="2">äºšæ´²ä»¥å¤–</th>
                        <th colspan="2">å¤œèˆª(å›½å†…)</th>
                        <th colspan="4">é©»å¤–è¡¥åŠ©</th>
                        <th colspan="2">æœºç»„é¤</th>
                        <th rowspan="2">èŠ‚å‡æ—¥</th>
                    </tr>
                    <tr>
                        <th>ç©ºä¸­</th><th>æ»‘è¡Œ</th><th>ç©ºä¸­</th><th>æ»‘è¡Œ</th>
                        <th>ç©ºä¸­</th><th>æ»‘è¡Œ</th><th>ç©ºä¸­</th><th>æ»‘è¡Œ</th>
                        <th>18:30+</th><th>00:00+</th>
                        <th>å›½æ— </th><th>å›½æœ‰</th><th>å¤–æ— </th><th>å¤–æœ‰</th>
                        <th>å›½</th><th>å¤–</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>${currentUser ? currentUser.displayName : '-'}</td>
                        <td>${s.d_air.toFixed(2)}</td><td>${s.d_bk}</td>
                        <td>${s.h_air.toFixed(2)}</td><td>${s.h_bk}</td>
                        <td>${s.a_air.toFixed(2)}</td><td>${s.a_bk}</td>
                        <td>${s.i_air.toFixed(2)}</td><td>${s.i_bk}</td>
                        <td>${s.n1.toFixed(2)}</td><td>${s.n2.toFixed(2)}</td>
                        <td>${s.o_d0}</td><td>${s.o_d1}</td>
                        <td>${s.o_i0}</td><td>${s.o_i1}</td>
                        <td>${s.m_d}</td><td>${s.m_i}</td>
                        <td>${s.hol}</td>
                    </tr>
                </tbody>
            `;
        };
    </script>
</body>
</html>
